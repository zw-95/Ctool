import{u as H,i as W}from"./action-e3a90178.js";import{d as N,ao as A,ap as z,aq as R,I as h,a2 as T,o as j,h as q,H as P,D as x,r as p,a as O,c as k,w as m,x as v,a0 as F,v as G,V as J,j as g,ar as K,as as $,at as Q,au as X,av as D,aw as Y,y as Z,ax as ee}from"./tool-f676037c.js";import"./modulepreload-polyfill-3cfb730f.js";const te=N({__name:"Diff",props:A({toolbar:{type:String,default:"bottom-right"},lang:{type:String,default:"text"},height:{type:[String,Number],default:"100%"},disableLineWrapping:{type:Boolean,default:!1},disableBorder:{type:Boolean,default:!1},disableLineNumbers:{type:Boolean,default:!1},disableClear:{type:Boolean,default:!1}},{original:{default:""},modified:{default:""}}),emits:["update:original","update:modified"],setup(_){const o=_,f=z(_,"original"),n=z(_,"modified"),M=R(),s=h(null),t=T(null),E=h(!o.disableLineWrapping),w=h(!o.disableLineNumbers),l=h(0),c=h(1),b=h(!1),B=async()=>{var e;t.value&&([t.value.getOriginalEditor(),t.value.getModifiedEditor()].forEach(a=>{var u;const d=a.getModel();d&&((u=D())==null||u.editor.setModelLanguage(d,Y(o.lang).id))}),t.value.updateOptions({renderSideBySide:!b.value}),(e=D())==null||e.editor.setTheme(M.theme.raw==="dark"?"vs-dark":"vs"))},I=async e=>{t.value&&t.value.dispose(),$.config({"vs/nls":{availableLanguages:{"*":$t("main_locale")==="zh_CN"?"zh-cn":"en"}}}),$.init().then(a=>{const d=a.editor.createModel(f.value),u=a.editor.createModel(n.value),i=a.editor.createDiffEditor(e,{lineNumbers:w.value?"on":"off",wordWrap:E.value?"on":"off",minimap:{enabled:!1},automaticLayout:!1,originalEditable:!0,scrollBeyondLastLine:!1,renderSideBySide:!b.value,enableSplitViewResizing:!1,scrollbar:{verticalScrollbarSize:5}});window._diffEditor=i,i.setModel({original:d,modified:u}),i.getOriginalEditor().onDidChangeModelContent(()=>{i.getOriginalEditor().getValue()!==f.value&&(f.value=i.getOriginalEditor().getValue())}),i.getModifiedEditor().onDidChangeModelContent(()=>{i.getModifiedEditor().getValue()!==n.value&&(n.value=i.getModifiedEditor().getValue())}),[i.getOriginalEditor(),i.getModifiedEditor()].forEach(r=>{new Q($t("main_ui_input"),r);const C=new X(r);C.setHandle("ctool_line_wrapping",(y,U,L)=>E.value=L),C.setHandle("ctool_line_number",(y,U,L)=>w.value=L)}),i.onDidUpdateDiff(()=>{var r;l.value=((r=i.getLineChanges())==null?void 0:r.length)||0,c.value=1}),t.value=i,B()})},S=e=>{var i,r;const a=((i=t.value)==null?void 0:i.getLineChanges())||[];let d=e==="prev"?c.value-1:c.value+1;const u=a.at(d-1);u&&((r=t.value)==null||r.revealLineInCenter(u.originalEndLineNumber),c.value=d)};j(async()=>{!o.disableClear&&q.addListener("content_clear",()=>V()),await I(s.value)}),P(()=>{var e;return(e=t.value)==null?void 0:e.dispose()});const V=(e="",a="")=>{t.value&&(t.value.getOriginalEditor().getValue()!==e&&t.value.getOriginalEditor().setValue(e),t.value.getModifiedEditor().getValue()!==a&&t.value.getModifiedEditor().setValue(a))};return x(()=>({original:f.value,modified:n.value}),e=>{if(t.value)return V(e.original,e.modified);const a=setInterval(()=>{t.value&&clearInterval(a),V(e.original,e.modified)},50)}),x(()=>({color:M.theme.raw,lang:o.lang,inline:b.value}),()=>B()),(e,a)=>{const d=p("Button"),u=p("Input"),i=p("Bool"),r=p("Align"),C=p("Display");return O(),k(C,{position:_.toolbar,right:35,class:"ctool-code-diff",style:J({height:`${g(K)(_.height)}`,width:"100%"}),toggle:""},{extra:m(()=>[v(r,null,{default:m(()=>[v(u,{size:"small",center:"",disabled:l.value===0,"model-value":`${l.value?c.value:0} / ${l.value}`,width:110},{prepend:m(()=>[v(d,{disabled:l.value===0||c.value===1,text:"<",onClick:a[0]||(a[0]=y=>S("prev"))},null,8,["disabled"])]),append:m(()=>[v(d,{disabled:l.value===0||c.value===l.value,text:">",onClick:a[1]||(a[1]=y=>S("next"))},null,8,["disabled"])]),_:1},8,["disabled","model-value"]),v(i,{modelValue:b.value,"onUpdate:modelValue":a[2]||(a[2]=y=>b.value=y),label:e.$t("component_editor_inline"),size:"small",border:""},null,8,["modelValue","label"]),F(e.$slots,"default")]),_:3})]),default:m(()=>[G("div",{ref_key:"container",ref:s,style:{height:"100%",width:"100%"}},null,512)]),_:3},8,["position","style"])}}});const le=N({__name:"Diffs",async setup(_){let o,f;const n=H(([o,f]=Z(()=>W({original:"",modified:"",option:{lang:"Text"}},{paste:!1})),o=await o,f(),o));return x(()=>n.current,()=>{n.current.original===""||n.current.modified===""||n.save()},{deep:!0}),(M,s)=>{const t=p("Select"),E=p("HeightResize");return O(),k(E,null,{default:m(({height:w})=>[v(te,{original:g(n).current.original,"onUpdate:original":s[1]||(s[1]=l=>g(n).current.original=l),modified:g(n).current.modified,"onUpdate:modified":s[2]||(s[2]=l=>g(n).current.modified=l),lang:g(n).current.option.lang,height:`${w}px`},{default:m(()=>[v(t,{size:"small",modelValue:g(n).current.option.lang,"onUpdate:modelValue":s[0]||(s[0]=l=>g(n).current.option.lang=l),options:g(ee)},null,8,["modelValue","options"])]),_:2},1032,["original","modified","lang","height"])]),_:1})}}});export{le as default};
